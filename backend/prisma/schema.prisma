generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String
  firstName     String
  lastName      String
  role          String    @default("USER")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  accounts      Account[]
  expenses      Expense[]
  loans         Loan[]
  subscriptions Subscription[]
  categories    Category[]
}

model Account {
  id            String      @id @default(uuid())
  name          String
  type          String
  balance       Float       @default(0)
  currency      String      @default("USD")
  accountNumber String?
  bank          String?
  userId        String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  expenses      Expense[]
  loanPayments  LoanPayment[]
}

model Category {
  id          String    @id @default(uuid())
  name        String
  color       String    @default("#3B82F6")
  icon        String?
  userId      String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  expenses    Expense[]

  @@unique([userId, name])
}

model Expense {
  id          String    @id @default(uuid())
  amount      Float
  description String
  date        DateTime  @default(now())
  userId      String
  accountId   String
  categoryId  String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  account     Account   @relation(fields: [accountId], references: [id], onDelete: Cascade)
  category    Category  @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@index([userId, date])
  @@index([categoryId])
  @@index([accountId])
}

model Loan {
  id              String      @id @default(uuid())
  name            String
  principal       Float
  interestRate    Float
  termMonths      Int
  startDate       DateTime    @default(now())
  monthlyPayment  Float
  status          String      @default("ACTIVE")
  userId          String
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  payments        LoanPayment[]
  amortization    AmortizationSchedule[]
}

model LoanPayment {
  id          String    @id @default(uuid())
  loanId      String
  accountId   String
  amount      Float
  paymentDate DateTime  @default(now())
  principal   Float
  interest    Float
  createdAt   DateTime  @default(now())

  loan        Loan      @relation(fields: [loanId], references: [id], onDelete: Cascade)
  account     Account   @relation(fields: [accountId], references: [id], onDelete: Cascade)
}

model AmortizationSchedule {
  id              String    @id @default(uuid())
  loanId          String
  month           Int
  paymentDate     DateTime
  payment         Float
  principal       Float
  interest        Float
  balance         Float
  createdAt       DateTime  @default(now())

  loan            Loan      @relation(fields: [loanId], references: [id], onDelete: Cascade)

  @@unique([loanId, month])
}

model Subscription {
  id              String                  @id @default(uuid())
  name            String
  amount          Float
  frequency       String
  startDate       DateTime                @default(now())
  nextPaymentDate DateTime
  isActive        Boolean                 @default(true)
  userId          String
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt

  user            User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  reminders       SubscriptionReminder[]
}

model SubscriptionReminder {
  id              String       @id @default(uuid())
  subscriptionId  String
  reminderDate    DateTime
  sent            Boolean      @default(false)
  createdAt       DateTime     @default(now())

  subscription    Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
}
